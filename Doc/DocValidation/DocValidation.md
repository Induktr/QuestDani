# Правила Валидации "Wisdom Forge"

### 1. Введение: Валидация как Гарант Целостности Системы

Этот документ определяет правила валидации для данных. Валидация обеспечивает **целостность (Принцип 7)** и **безопасность (Принцип 5)** нашей платформы.

**Принцип:** Валидация всегда происходит на **клиенте** (для мгновенной обратной связи) и дублируется на **бэкенде** (как единый источник правды).

### 2. Правила для Аутентификации

#### **Поле: `email`**
*   **Правило 1 (Формат):** Должен быть валидным email-адресом.
    *   *Сообщение:* "Введите корректный email".
*   **Правило 2 (Уникальность - Backend):** Email должен быть уникальным.
    *   *Сообщение:* "Этот email уже используется".

#### **Поле: `password`**
*   **Правило 1 (Длина):** Минимальная длина — 8 символов.
    *   *Сообщение:* "Пароль должен содержать минимум 8 символов".
*   **Правило 2 (Сложность):** Должен содержать хотя бы одну цифру.
    *   *Сообщение:* "Пароль должен содержать хотя бы одну цифру".

### 3. Правила для Игровой Логики (Backend)**

#### **Мутация: `completeTrial(trialId: ID!, result: JSON)`**
*   **Правило 1 (Существование):** `trialId` должен существовать в базе данных.
    *   *Ошибка:* `NOT_FOUND` ("Испытание не найдено").
*   **Правило 2 (Авторизация):** Текущий пользователь должен иметь активную сессию прохождения этого квеста.
    *   *Ошибка:* `FORBIDDEN` ("У вас нет доступа к этому испытанию").
*   **Правило 3 (Формат `result`):** Структура `result` должна соответствовать ожидаемому формату для данного `gameType` испытания.
    *   **Пример для "filter-game":** `result` должен быть объектом вида `{ "correct": 10, "missed": 2 }`.
    *   *Ошибка:* `BAD_USER_INPUT` ("Неверный формат результата").
*   **Правило 4 (Валидация Результата):** Сервер должен **перепроверить** результат. Нельзя доверять данным от клиента. Бэкенд должен заново вычислить, был ли результат успешным, на основе отправленных данных.
    *   *Пример:* Если `result.correct < 10`, мутация должна вернуть ошибку или статус "неуспешно".
    *   *Ошибка:* `BAD_USER_INPUT` ("Результат испытания не соответствует критериям успеха").

### 4. Техническая Реализация

*   **Frontend (Next.js):** Валидация форм с помощью `react-hook-form` и `Zod`.
*   **Backend (NestJS):** Валидация DTO для мутаций с помощью `class-validator`. Серверная перепроверка игровой логики внутри сервисов.